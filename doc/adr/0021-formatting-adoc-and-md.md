# 21. Formatting AsciiDoctor and Markdown

Date: 2020-10-07

## Status

Musing

## Context

### Background

Cljdoc currently supports AsciiDoctor and CommonMark.

An article can be written in either format.

A docstring can be written in CommonMark. A docstring differs from an article in that it:

- Supports linking to library vars via wikilinks
- Does not render HTML.

### Issues

I see the following issues:

1. Formatting for AsciiDoctor is incomplete. For examples:
    - Tables have no grids whatsoever
    - Code block titles (and maybe element titles in general) are rendered plain
    - Admonitions formatting could be improved
    - Code callouts are not formatted

2. Formatting for AsciiDoctor and CommonMark is inconsistent. 
Tables, links, headings, quote blocks, etc, should look and behave consistently between both formats.

Up for debate:

1. How far do we want to go with AsciiDoctor styling? 
In my opinion GitHub goes too far on the minimalist side here. 
I think we can do better.

Questions:

1. Did we intend to support a GitHub flavored CommonMark? Or just CommonMark in general?
2. Does a docstring get different styling treatment than an article?  
The only example I can think of right now is headings, which, if styled the same way as an article will visually dominate.

## Decision

1. Out of scope:

- Source code highlighting support is currently handled by hightlight.js. 
For the near term, I think we should stick with this as it seems to work well.

2. 

## Alternatives

**#1 [rejected] do nothing**

Live with what we've got.
I think we can do a better.

**#2 [rejected] work within AsciiDoctor's styling world**

[AsciiDoctor's css styling](https://github.com/asciidoctor/asciidoctor-stylesheet-factory) is based on aging technology.
It is derived from [Zurb Foundation](https://get.foundation/) v4.3.2 and uses FontAwesome v4.7.0 and is generated from an older version of Sass via Ruby's [Compass](http://compass-style.org/install/) v0.12.7.

Working within this world is an unfamiliar maintenance burden for cljdoc developers.

**#3 [rejected] adapt AsciiDoctor's generated stylesheet**

This is similar to option #2, but works from the style sheet that is generated by AsciiDoctor rather than from the source.

I took a stab at this but it really hurt my brain. 
The AsciiDoctor generated CSS is not easy to work with and adapt. 

**#4 [researching] take a Tachyons approach**

Cljdoc adopted Tachyons for styling.
The maintenance benefit of is a visual component's styling is specific and isolated from other styling.

I'm guessing the strategy might be, for example, to write a single render-table function that would be used to render all tables.

Should we use Tachyons to style adoc and md?

We are currenlty using AsciiDoctorJ to render adoc and Flexmark to render md.

AsciiDoctorJ does support custom converters, so we could spit out whatever html and styling we like. 

Flexmark spits out plain html with no css classes. We can insert ourselves into its world, perhaps via its [AttributeProvider feature](https://github.com/vsch/flexmark-java/wiki/Usage#customize-html-attributes-via-attribute-provider)? I don't know, need to experiment. 

An issue with CommonMark is that it allows a limited subset of HTML to be embedded.
How do we insert ourselves for that? Does Flexmark parse out individual html elements?
I think this HTML is usually representative of CommonMark, but would have to study.

## Consequences

The cost of better formatting is primarily the maintenance burden. We are getting deeper into controlling

Any performance issues we need to worry about?
